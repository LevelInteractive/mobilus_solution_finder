var data = '{"Answer01":{"A":{"S01":25,"S02":0,"S03":0,"S04":0,"S05":0,"S06":0,"S07":25,"S08":0,"S09":0,"S10":0,"S11":0,"S12":25,"S13":25,"S14":25,"S15":0,"S16":0,"S17":25,"S18":25,"S19":25,"S20":0,"S21":25,"S22":25,"S23":25,"S24":25,"S25":25},"B":{"S01":0,"S02":25,"S03":25,"S04":25,"S05":25,"S06":25,"S07":25,"S08":25,"S09":25,"S10":25,"S11":25,"S12":25,"S13":0,"S14":25,"S15":25,"S16":25,"S17":0,"S18":0,"S19":25,"S20":25,"S21":0,"S22":0,"S23":25,"S24":0,"S25":25},"C":{"S01":0,"S02":25,"S03":25,"S04":25,"S05":25,"S06":25,"S07":25,"S08":25,"S09":25,"S10":25,"S11":25,"S12":25,"S13":0,"S14":25,"S15":25,"S16":25,"S17":0,"S18":0,"S19":25,"S20":25,"S21":0,"S22":0,"S23":25,"S24":0,"S25":25},"D":{"S01":0,"S02":0,"S03":0,"S04":0,"S05":0,"S06":0,"S07":0,"S08":0,"S09":0,"S10":0,"S11":0,"S12":0,"S13":0,"S14":0,"S15":0,"S16":0,"S17":0,"S18":0,"S19":0,"S20":0,"S21":0,"S22":0,"S23":0,"S24":0,"S25":0},"Z":{"S01":0,"S02":0,"S03":0,"S04":0,"S05":0,"S06":0,"S07":0,"S08":0,"S09":0,"S10":0,"S11":0,"S12":0,"S13":0,"S14":0,"S15":0,"S16":0,"S17":0,"S18":0,"S19":0,"S20":0,"S21":0,"S22":0,"S23":0,"S24":0,"S25":0}},"Answer02":{"A":{"S01":0,"S02":50,"S03":50,"S04":0,"S05":0,"S06":50,"S07":50,"S08":50,"S09":0,"S10":0,"S11":0,"S12":50,"S13":0,"S14":50,"S15":0,"S16":0,"S17":0,"S18":0,"S19":50,"S20":0,"S21":0,"S22":0,"S23":0,"S24":0,"S25":50},"B":{"S01":0,"S02":0,"S03":50,"S04":0,"S05":0,"S06":50,"S07":50,"S08":50,"S09":50,"S10":0,"S11":0,"S12":50,"S13":0,"S14":50,"S15":0,"S16":0,"S17":0,"S18":0,"S19":50,"S20":0,"S21":0,"S22":0,"S23":0,"S24":0,"S25":50},"C":{"S01":0,"S02":0,"S03":0,"S04":50,"S05":50,"S06":0,"S07":50,"S08":0,"S09":50,"S10":50,"S11":50,"S12":50,"S13":0,"S14":50,"S15":50,"S16":50,"S17":0,"S18":0,"S19":50,"S20":50,"S21":0,"S22":0,"S23":50,"S24":0,"S25":50},"D":{"S01":0,"S02":0,"S03":0,"S04":50,"S05":50,"S06":0,"S07":50,"S08":0,"S09":50,"S10":50,"S11":50,"S12":50,"S13":0,"S14":50,"S15":50,"S16":50,"S17":0,"S18":0,"S19":50,"S20":50,"S21":0,"S22":0,"S23":50,"S24":0,"S25":50},"Z":{"S01":0,"S02":0,"S03":0,"S04":0,"S05":0,"S06":0,"S07":0,"S08":0,"S09":0,"S10":0,"S11":0,"S12":0,"S13":0,"S14":0,"S15":0,"S16":0,"S17":0,"S18":0,"S19":0,"S20":0,"S21":0,"S22":0,"S23":0,"S24":0,"S25":0}},"Answer03":{"A":{"S01":50,"S02":0,"S03":0,"S04":0,"S05":0,"S06":0,"S07":50,"S08":0,"S09":0,"S10":0,"S11":0,"S12":50,"S13":50,"S14":50,"S15":0,"S16":0,"S17":50,"S18":0,"S19":50,"S20":0,"S21":50,"S22":50,"S23":0,"S24":50,"S25":50},"B":{"S01":50,"S02":0,"S03":0,"S04":0,"S05":0,"S06":0,"S07":50,"S08":0,"S09":0,"S10":0,"S11":0,"S12":50,"S13":50,"S14":50,"S15":0,"S16":0,"S17":50,"S18":0,"S19":50,"S20":0,"S21":50,"S22":50,"S23":0,"S24":50,"S25":50},"C":{"S01":50,"S02":0,"S03":0,"S04":0,"S05":0,"S06":0,"S07":50,"S08":0,"S09":0,"S10":0,"S11":0,"S12":50,"S13":50,"S14":50,"S15":0,"S16":0,"S17":50,"S18":50,"S19":50,"S20":0,"S21":50,"S22":0,"S23":50,"S24":50,"S25":50},"Z":{"S01":0,"S02":0,"S03":0,"S04":0,"S05":0,"S06":0,"S07":0,"S08":0,"S09":0,"S10":0,"S11":0,"S12":0,"S13":0,"S14":0,"S15":0,"S16":0,"S17":0,"S18":0,"S19":0,"S20":0,"S21":0,"S22":0,"S23":0,"S24":0,"S25":0}},"Answer04":{"A":{"S01":100,"S02":100,"S03":100,"S04":100,"S05":0,"S06":0,"S07":0,"S08":0,"S09":100,"S10":100,"S11":100,"S12":100,"S13":100,"S14":100,"S15":100,"S16":0,"S17":100,"S18":0,"S19":100,"S20":100,"S21":100,"S22":100,"S23":100,"S24":100,"S25":100},"B":{"S01":100,"S02":0,"S03":100,"S04":0,"S05":100,"S06":100,"S07":100,"S08":100,"S09":0,"S10":100,"S11":0,"S12":0,"S13":100,"S14":100,"S15":0,"S16":100,"S17":100,"S18":100,"S19":100,"S20":0,"S21":100,"S22":100,"S23":100,"S24":100,"S25":0},"C":{"S01":100,"S02":0,"S03":100,"S04":0,"S05":100,"S06":100,"S07":100,"S08":100,"S09":0,"S10":100,"S11":0,"S12":0,"S13":100,"S14":100,"S15":0,"S16":100,"S17":100,"S18":100,"S19":100,"S20":0,"S21":100,"S22":100,"S23":100,"S24":100,"S25":0},"D":{"S01":100,"S02":100,"S03":100,"S04":100,"S05":100,"S06":100,"S07":100,"S08":100,"S09":100,"S10":100,"S11":100,"S12":100,"S13":100,"S14":100,"S15":100,"S16":100,"S17":100,"S18":100,"S19":100,"S20":100,"S21":100,"S22":100,"S23":100,"S24":100,"S25":100},"E":{"S01":0,"S02":0,"S03":0,"S04":0,"S05":0,"S06":0,"S07":0,"S08":0,"S09":0,"S10":0,"S11":0,"S12":0,"S13":0,"S14":0,"S15":0,"S16":0,"S17":0,"S18":0,"S19":0,"S20":0,"S21":0,"S22":0,"S23":0,"S24":0,"S25":0},"Z":{"S01":0,"S02":0,"S03":0,"S04":0,"S05":0,"S06":0,"S07":0,"S08":0,"S09":0,"S10":0,"S11":0,"S12":0,"S13":0,"S14":0,"S15":0,"S16":0,"S17":0,"S18":0,"S19":0,"S20":0,"S21":0,"S22":0,"S23":0,"S24":0,"S25":0}},"Answer05":{"A":{"S01":0,"S02":75,"S03":0,"S04":75,"S05":75,"S06":75,"S07":0,"S08":75,"S09":75,"S10":75,"S11":75,"S12":0,"S13":0,"S14":0,"S15":75,"S16":75,"S17":0,"S18":75,"S19":0,"S20":75,"S21":0,"S22":0,"S23":75,"S24":75,"S25":0},"B":{"S01":75,"S02":0,"S03":75,"S04":0,"S05":0,"S06":0,"S07":0,"S08":0,"S09":0,"S10":0,"S11":0,"S12":0,"S13":0,"S14":0,"S15":0,"S16":0,"S17":75,"S18":0,"S19":0,"S20":0,"S21":0,"S22":0,"S23":75,"S24":0,"S25":75},"C":{"S01":0,"S02":0,"S03":0,"S04":0,"S05":0,"S06":0,"S07":0,"S08":0,"S09":0,"S10":0,"S11":0,"S12":0,"S13":0,"S14":75,"S15":0,"S16":0,"S17":0,"S18":0,"S19":75,"S20":0,"S21":0,"S22":0,"S23":75,"S24":0,"S25":0},"D":{"S01":0,"S02":0,"S03":0,"S04":0,"S05":0,"S06":0,"S07":75,"S08":0,"S09":0,"S10":0,"S11":0,"S12":75,"S13":0,"S14":0,"S15":0,"S16":0,"S17":0,"S18":0,"S19":0,"S20":0,"S21":0,"S22":0,"S23":75,"S24":0,"S25":0},"E":{"S01":0,"S02":0,"S03":0,"S04":0,"S05":0,"S06":0,"S07":0,"S08":0,"S09":0,"S10":0,"S11":0,"S12":0,"S13":75,"S14":0,"S15":0,"S16":0,"S17":0,"S18":0,"S19":0,"S20":0,"S21":75,"S22":75,"S23":75,"S24":0,"S25":0},"F":{"S01":0,"S02":0,"S03":0,"S04":0,"S05":0,"S06":0,"S07":0,"S08":0,"S09":0,"S10":0,"S11":0,"S12":0,"S13":0,"S14":0,"S15":0,"S16":0,"S17":0,"S18":0,"S19":0,"S20":0,"S21":0,"S22":0,"S23":0,"S24":0,"S25":0},"Z":{"S01":0,"S02":0,"S03":0,"S04":0,"S05":0,"S06":0,"S07":0,"S08":0,"S09":0,"S10":0,"S11":0,"S12":0,"S13":0,"S14":0,"S15":0,"S16":0,"S17":0,"S18":0,"S19":0,"S20":0,"S21":0,"S22":0,"S23":0,"S24":0,"S25":0}}}';


var json = JSON.parse(data);

// Build answer object
var answer = {
    answer01:respondent.answer01,
    answer02:respondent.answer02,
    answer03:respondent.answer03,
    answer04:respondent.answer04,
    answer05:respondent.answer05
};


 

function getPlanValues(json, answer, plan) {
    var planValue = 0;


    planValue = json['Answer01'][answer.answer01][plan] + json['Answer02'][answer.answer02][plan] + json['Answer03'][answer.answer03][plan] + json['Answer04'][answer.answer04][plan];

    //answer 5
    var answer5Str = answer.answer05
    var answer5Arr = answer5Str.split(',');
    var answer5Val = 0;
    for( var i=0; i<answer5Arr.length; i++){
        newAnswerVal = answer5Arr[i];
        answer5Val += json['Answer05'][newAnswerVal][plan];
    }

	return planValue + answer5Val;
}
  if (answer.answer01 == null) {
    answer.answer01 = "Z"
  }
  if (answer.answer02 == null) {
    answer.answer02 = "Z"
  }
  if (answer.answer03 == null) {
    answer.answer03 = "Z"
  }
  if (answer.answer04 == null) {
    answer.answer04 = "Z"
  }
  if (answer.answer05 == null) {
    answer.answer05 = "Z"
  }


// get plan values
var S01 = getPlanValues(json, answer, 'S01');
var S02 = getPlanValues(json, answer, 'S02');
var S03 = getPlanValues(json, answer, 'S03');
var S04 = getPlanValues(json, answer, 'S04');
var S05 = getPlanValues(json, answer, 'S05');
var S06 = getPlanValues(json, answer, 'S06');
var S07 = getPlanValues(json, answer, 'S07');
var S08 = getPlanValues(json, answer, 'S08');
var S09 = getPlanValues(json, answer, 'S09');
var S10 = getPlanValues(json, answer, 'S10');
var S11 = getPlanValues(json, answer, 'S11');
var S12 = getPlanValues(json, answer, 'S12');
var S13 = getPlanValues(json, answer, 'S13');
var S14 = getPlanValues(json, answer, 'S14');
var S15 = getPlanValues(json, answer, 'S15');
var S16 = getPlanValues(json, answer, 'S16');
var S17 = getPlanValues(json, answer, 'S17');
var S18 = getPlanValues(json, answer, 'S18');
var S19 = getPlanValues(json, answer, 'S19');
var S20 = getPlanValues(json, answer, 'S20');
var S21 = getPlanValues(json, answer, 'S21');
var S22 = getPlanValues(json, answer, 'S22');
var S23 = getPlanValues(json, answer, 'S23');
var S24 = getPlanValues(json, answer, 'S24');
var S25 = getPlanValues(json, answer, 'S25');



// Create plan array of all plan scores
var planArray = [{
		key: 'S01',
		value: S01
	}, {
		key: 'S02',
		value: S02
	}, {
		key: 'S03',
		value: S03
	}, {
		key: 'S04',
		value: S04
	}, {
		key: 'S05',
		value: S05
	}, {
		key: 'S06',
		value: S06
	}, {
		key: 'S07',
		value: S07
	}, {
		key: 'S08',
		value: S08
	}, {
		key: 'S09',
		value: S09
	}, {
		key: 'S10',
		value: S10
	}, {
		key: 'S11',
		value: S11
	}, {
		key: 'S12',
		value: S12
	}, {
		key: 'S13',
		value: S13
	}, {
		key: 'S14',
		value: S14
	}, {
		key: 'S15',
		value: S15
	}, {
		key: 'S16',
		value: S16
	}, {
		key: 'S17',
		value: S17
	}, {
		key: 'S18',
		value: S18
	}, {
		key: 'S19',
		value: S19
	}, {
		key: 'S20',
		value: S20
	}, {
		key: 'S21',
		value: S21
	}, {
		key: 'S22',
		value: S22
	}, {
		key: 'S23',
		value: S23
	}, {
		key: 'S24',
		value: S24
	}, {
		key: 'S25',
		value: S25
	}
];


// Sort plan array alphanumerically


planArray.sort(function(a, b){
    if(a.value === b.value)
    {
        var x = a.key, y = b.key;
        
        return x < y ? -1 : x > y ? 1 : 0;
    }
    return b.value - a.value;
});
console.log(planArray);


  // Save the Top Plans to Ion Respondent Data
  actionSaveDataBulk({
  	"Plan01": planArray[0].key,
  	"Plan02": planArray[1].key
  });


  // get top plan names from lookup table
  actionSaveDataBulk({
  	"Subscription01Name": actionLookupValue("sae_mobilus_subs", planArray[0].key),
  	"Subscription02Name": actionLookupValue("sae_mobilus_subs", planArray[1].key)
  });


  // get top plan descriptions from lookup table
  actionSaveDataBulk({
  	"Subscription01Description": actionLookupValue("sae_mobulus_subsdescription", planArray[0].key),
  	"Subscription02Description": actionLookupValue("sae-mobilus_subsdescription", planArray[1].key)
  });
  
  actionSaveDataBulk({
    "S01": S01,
    "S02": S02,
    "S03": S03,
    "S04": S04,
    "S05": S05,
    "S06": S06,
    "S07": S07,
    "S08": S08,
    "S09": S09,
    "S10": S10,
    "S11": S11,
    "S12": S12,
    "S13": S13,
    "S14": S14,
    "S15": S15,
    "S16": S16,
    "S17": S17,
    "S18": S18,
    "S19": S19,
    "S20": S20,
    "S21": S21,
    "S22": S22,
    "S23": S23,
    "S24": S24,
    "S25": S25
  });